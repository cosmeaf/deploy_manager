{% block scripts %}
<script>
function checkForUpdates() {
    fetch("{% url 'check_updates' %}")
        .then(response => response.json())
        .then(data => {
            const updatedProjects = data.updates.map(p => p.id.toString());
            document.querySelectorAll("tbody tr[id^='project-']").forEach(row => {
                const projectId = row.id.replace('project-', '');
                const badge = row.querySelector('.badge-status');

                if (updatedProjects.includes(projectId)) {
                    row.classList.add('table-success');
                    badge.classList.remove('bg-secondary');
                    badge.classList.add('bg-success');
                    badge.innerHTML = '<i class="fas fa-circle me-1"></i>Novo push';
                } else {
                    row.classList.remove('table-success');
                    badge.classList.remove('bg-success');
                    badge.classList.add('bg-secondary');
                    badge.innerHTML = '<i class="fas fa-circle me-1"></i>Sem push';
                }
            });

            // Alerta sonoro opcional ao detectar atualizações
            if (updatedProjects.length > 0) {
                const audio = new Audio("https://notificationsounds.com/storage/sounds/file-sounds-1152-pristine.mp3");
                audio.play();
            }
        })
        .catch(error => console.error('Erro ao verificar atualizações:', error));
}

// Verifica atualizações a cada 60 segundos
setInterval(checkForUpdates, 60000);

// Primeira verificação logo após carregar a página
document.addEventListener('DOMContentLoaded', checkForUpdates);
</script>
{% endblock %}
